import{a3 as E,a4 as $,X as z,r,a as P,W as M,j as e}from"./index-CuCeFzuJ.js";import{r as O,g as p,S as F,p as U,a as f}from"./StickyFooter-CR3ig-ei.js";import{B as m}from"./Button-s14vX6fw.js";import{a as G}from"./index.esm-vIrvkAm0.js";import{c as L,d as H,e as K}from"./index.esm-DFlYR4h_.js";import{u as W}from"./index-BE7OhiUZ.js";import"./CampaignRewardTrackingService-D6FBU9so.js";const X=E({data:O}),J=$;z("TrackingDetails",X);const Q=()=>{const[i,y]=r.useState(!1),[d,w]=r.useState(!1),[b,j]=r.useState(""),[x,u]=r.useState(""),[N,v]=r.useState(!1),[t,k]=r.useState(),C=W(s=>s.rewardTracking.data.TrackingList),g=J(s=>s.TrackingDetails.data.message),[o,_]=r.useState([]),l=r.useRef(null),c=P(),h=M(),R=()=>{h("/rewardTracking")};function S(s,a){return a.find(n=>n.Id===s)}const A=async(s,a)=>{if(s.trim()!="")try{c(U({ticket_id:Number(a),msg:s,type:2}))}catch(n){console.error("Error fetching chat:",n)}finally{u(""),setTimeout(()=>{c(p({ticket_id:Number(a),type:2}))},500)}},T=async(s,a)=>{a(!0);try{const n=await c(f(s));f.fulfilled.match(n)?h("/rewardTracking"):console.error("API Request Failed:",n.error)}catch(n){console.error("Unexpected Error:",n)}finally{a(!1)}};function B(s){return["http://","https://","www.",".com",".net",".org"].some(n=>s.includes(n))}function I(s){return console.log(s),[{actor:2,msg:`Hello, ${s.user_name} here! I would like to request the initiation of my participation reward of ₹${s.reward_amt} for the store "${s.store}". Thank you!`,created_at:s.created_at},...s.notes?[{actor:2,msg:s.notes,created_at:s.created_at}]:[]]}return r.useEffect(()=>{const s=location.pathname.substring(location.pathname.lastIndexOf("/")+1),a=S(s,C);c(p({ticket_id:Number(a==null?void 0:a.Id),type:2})),k(a)},[location.pathname]),r.useEffect(()=>{if(!t)return;const a=[...I(t),...g||[]];_(a)},[g]),r.useEffect(()=>{l.current&&(l.current.scrollTop=l.current.scrollHeight)},[o]),e.jsxs("main",{className:"flex flex-col",children:[e.jsxs("section",{className:"flex flex-col md:flex-row w-full bg-white shadow-lg rounded-lg p-6 mb-6 0 min-h-[500px]",children:[e.jsxs("div",{className:" w-full md:w-[40%] ",children:[e.jsxs("div",{className:"flex flex-col justify-evenly items-center  p-4 max-h-80",children:[e.jsx(L,{size:100,className:"text-gray-500 mb-4"}),e.jsx("hr",{className:"w-[30%] border-gray-300 mb-4"}),e.jsx("h1",{className:"text-xl font-semibold text-gray-800",children:t==null?void 0:t.user_name}),e.jsx("p",{className:"text-gray-600 flex gap-2 my-1",children:t==null?void 0:t.id_user}),e.jsxs("p",{className:"text-gray-600 flex gap-2 my-1",children:[e.jsx(H,{size:16}),t==null?void 0:t.user_phone]}),e.jsx("hr",{className:"w-full border-gray-300 mt-4"})]}),e.jsxs("div",{className:"flex flex-col justify-between p-4 space-y-4 ",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:t==null?void 0:t.store}),e.jsx("h2",{className:"text-lg font-medium text-gray-700",children:t==null?void 0:t.retailer}),e.jsxs("p",{className:"text-lg font-semibold ",children:["Reward Amount: ",e.jsxs("span",{className:"text-green-600",children:["₹ ",t==null?void 0:t.reward_amt]})]}),e.jsx("hr",{}),e.jsxs("aside",{className:"flex flex-col bg-white shadow-md rounded-lg mt-5 p-2 ",children:[e.jsx("h2",{className:"text-lg w-full font-medium text-center p-2",children:"Reward Configuration"}),e.jsxs("div",{className:"w-full mx-auto  bg-white shadow-sm rounded-lg",children:[e.jsxs("button",{className:"text-base w-full flex justify-between items-center p-3 text-left font-normal  rounded-lg focus:outline-none",onClick:()=>y(!i),children:[e.jsx("span",{children:"Reward points"}),e.jsx("span",{children:i?"▲":"▼"})]}),e.jsxs("div",{className:`overflow-hidden transition-max-height duration-500 ease-in-out flex flex-col ${i?"max-h-96 p-4":"max-h-0 p-0"}`,children:[e.jsx("input",{id:"rewardAmount",type:"text",value:b,onChange:s=>j(s.target.value),placeholder:"Enter new reward points",className:"w-full border rounded-lg p-2 text-gray-700 focus:outline-none focus:ring focus:ring-gray-200"}),e.jsx("button",{className:"mt-4 w-fit px-5 bg-primary ml-auto text-white py-2 rounded-lg hover:bg-primary",children:"Process Now"})]})]}),e.jsxs("div",{className:"w-full mx-auto  bg-white shadow-sm rounded-lg",children:[e.jsxs("button",{className:"text-base w-full flex justify-between items-center p-3 text-left font-normal  rounded-lg focus:outline-none",onClick:()=>w(!d),children:[e.jsx("span",{children:"Gift Card"}),e.jsx("span",{children:d?"▲":"▼"})]}),e.jsxs("div",{className:`overflow-hidden transition-max-height duration-500 ease-in-out flex flex-col ${d?"max-h-96 p-4":"max-h-0 p-0"}`,children:[e.jsx("input",{id:"rewardAmount",type:"text",value:"",onChange:s=>null,placeholder:"Brand Name",className:"w-full border rounded-lg p-2 my-2 text-gray-700 focus:outline-none focus:ring focus:ring-gray-200"}),e.jsx("input",{id:"rewardAmount",type:"text",value:"",onChange:s=>null,placeholder:"Brand Key",className:"w-full border rounded-lg p-2 my-2 text-gray-700 focus:outline-none focus:ring focus:ring-gray-200"}),e.jsx("input",{id:"rewardAmount",type:"text",value:"",onChange:s=>null,placeholder:"Brand URL",className:"w-full border rounded-lg p-2 my-2 text-gray-700 focus:outline-none focus:ring focus:ring-gray-200"}),e.jsx("button",{className:"mt-4 w-fit px-5 bg-primary ml-auto text-white py-2 rounded-lg hover:bg-primary",children:"Process Now"})]})]})]})]})]}),e.jsxs("section",{className:"w-full md:w-[60%] max-h-fit rounded-xl mx-auto  bg-white shadow-md",children:[e.jsxs("div",{className:"flex items-center p-4 border-b bg-primary text-white gap-2 mb-4",children:[e.jsx(K,{size:30}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-semibold",children:t==null?void 0:t.user_name}),e.jsx("p",{className:"text-sm",children:"Support Chat"})]})]}),e.jsx("div",{ref:l,className:"h-96 overflow-y-auto px-10 scrollbar-thin scrollbar-thumb-gray-600",children:o==null?void 0:o.map(s=>e.jsxs("div",{className:`mb-4 ${s.actor===1?"text-right ":"text-left"}`,children:[e.jsx("p",{className:"text-sm font-semibold",children:s.actor==1?"Cheggout":t==null?void 0:t.user_name}),e.jsx("div",{className:`chatBox relative inline-block p-2 rounded-lg ${s.actor===1?"bg-blue-100 chatBox_admin":"bg-gray-200 chatBox_customer"}`,children:B(s.msg)?e.jsx("img",{src:s.msg,alt:"Chat Attachment",className:"mt-2 max-w-xs rounded"}):e.jsx("p",{children:s.msg})}),e.jsx("p",{className:"text-xs text-gray-500",children:new Date(s.created_at).toLocaleString()})]},s.created_at))}),e.jsxs("div",{className:"flex items-center p-3 border-t bg-gray-100",children:[e.jsx("input",{type:"text",placeholder:"Enter your message here",value:x,onChange:s=>u(s.target.value),className:"flex-1 p-2 border rounded-lg"}),e.jsx(m,{size:"sm",variant:"solid",onClick:()=>A(x,t==null?void 0:t.Id),type:"submit",className:"ml-2",children:"Reply"})]})]})]}),e.jsxs(F,{className:"-mx-8 px-8 flex items-center justify-end py-4 z-10 gap-2",stickyClass:"border-t bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700",children:[e.jsx(m,{size:"sm",variant:"solid",onClick:R,type:"submit",children:"Discard"}),e.jsx(m,{size:"sm",variant:"solid",color:"red",loading:N,icon:e.jsx(G,{}),onClick:()=>T({id:t==null?void 0:t.Id,report_status:"resolved"},v),type:"submit",children:"Close Ticket"})]})]})};Q.displayName="RewardTrackingDetails";export{Q as default};
