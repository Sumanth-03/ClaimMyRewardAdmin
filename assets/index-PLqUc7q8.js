import{a5 as b,a6 as M,a3 as z,a4 as P,G as $,X as B,r as i,a as F,W as O,j as s}from"./index-CuCeFzuJ.js";import{c as L,u as U}from"./index-CdpwxF2_.js";import{b as G,S as H,p as V}from"./StickyFooter-CR3ig-ei.js";import{B as f}from"./Button-s14vX6fw.js";import{a as W}from"./index.esm-vIrvkAm0.js";import{c as X,d as J,e as K}from"./index.esm-DFlYR4h_.js";import"./CampaignRewardTrackingService-D6FBU9so.js";const h="merchantRewardTrackingDetails",d=b(h+"/postCampaignResolve",async(n,{rejectWithValue:r})=>{var o,x;try{return(await L(n)).data}catch(c){return console.error("API Error:",c),r({message:((x=(o=c==null?void 0:c.response)==null?void 0:o.data)==null?void 0:x.message)||"Something went wrong"})}}),m=b(h+"/getChat",async n=>{console.log("calling");const r=await G(n);return console.log(r.data),r.data}),Q={loading:!1,refresh:0,message:void 0},Y=M({name:`${h}/state`,initialState:Q,reducers:{},extraReducers:n=>{n.addCase(d.fulfilled,(r,o)=>{r.loading=!1}).addCase(d.pending,r=>{r.loading=!0}).addCase(d.rejected,(r,o)=>{console.error("API Request Failed:",o.error.message),r.loading=!1}).addCase(m.fulfilled,(r,o)=>{console.log("fullfilled"),r.message=o.payload.data,r.loading=!1}).addCase(m.pending,r=>{r.loading=!0}).addCase(m.rejected,(r,o)=>{console.error("API Request Failed:",o.error.message),r.loading=!1})}}),Z=Y.reducer,D=z({data:Z}),q=P;function ee(n){return $({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M424 80H88a56.06 56.06 0 00-56 56v240a56.06 56.06 0 0056 56h336a56.06 56.06 0 0056-56V136a56.06 56.06 0 00-56-56zm-14.18 92.63l-144 112a16 16 0 01-19.64 0l-144-112a16 16 0 1119.64-25.26L256 251.73l134.18-104.36a16 16 0 0119.64 25.26z"}}]})(n)}B("merchantRewardTrackingDetails",D);const se=()=>{const[n,r]=i.useState(!1),[o,x]=i.useState(""),[c,y]=i.useState(""),[N,v]=i.useState(!1),[a,k]=i.useState(),C=U(e=>e.merchantRewardTracking.data.TrackingList),w=q(e=>e.merchantRewardTrackingDetails.data.message),g=i.useRef(null),[u,R]=i.useState([]),p=F(),j=O(),_=()=>{j("/rewardTracking")};function S(e,t){return t.find(l=>l.Id===e)}const A=async(e,t)=>{if(e.trim()!="")try{await p(V({ticket_id:Number(t),msg:e,type:1}))}catch(l){console.error("Error fetching chat:",l)}finally{y(""),setTimeout(()=>{p(m({ticket_id:Number(t),type:1}))},500)}},I=async(e,t)=>{t(!0);try{const l=await p(d(e));d.fulfilled.match(l)?j("/rewardTracking"):console.error("API Request Failed:",l.error)}catch(l){console.error("Unexpected Error:",l)}finally{t(!1)}};function T(e){return["http://","https://"].some(l=>e.includes(l))}i.useEffect(()=>{const e=location.pathname.substring(location.pathname.lastIndexOf("/")+1),t=S(e,C);p(m({ticket_id:Number(t==null?void 0:t.Id),type:1})),k(t)},[location.pathname]);function E(e){return console.log(e),{actor:2,msg:`Hello, ${e.user_name} here! I’d like to request my purchase reward of ₹${e.reward_amt} for order ID ${e.order_id}, purchased on ${new Date(e.purchase_date).toLocaleDateString()}. Please process it at the earliest. Thank you!`,created_at:e.created_at}}return i.useEffect(()=>{if(!a)return;const t=[E(a),...w||[]];R(t)},[w]),i.useEffect(()=>{g.current&&(g.current.scrollTop=g.current.scrollHeight)},[u]),s.jsxs("main",{className:"flex flex-col",children:[s.jsxs("section",{className:"flex flex-col md:flex-row w-full bg-white shadow-lg rounded-lg p-6 mb-6 0 min-h-[500px]",children:[s.jsxs("div",{className:" w-full md:w-[40%] ",children:[s.jsxs("div",{className:"flex flex-col justify-evenly items-center border-r border-gray-200 p-4 max-h-80",children:[s.jsx(X,{size:100,className:"text-gray-500 mb-4"}),s.jsx("hr",{className:"w-full border-gray-300 mb-4"}),s.jsx("h1",{className:"text-xl font-semibold text-gray-800",children:a==null?void 0:a.user_name}),s.jsx("p",{className:"text-gray-600 flex gap-2 my-1",children:a==null?void 0:a.id_user}),s.jsxs("p",{className:"text-gray-600 flex gap-2 my-1",children:[s.jsx(J,{size:16}),a==null?void 0:a.user_phone]}),s.jsxs("p",{className:"text-gray-600 flex gap-2 items-center",children:[s.jsx(ee,{size:16})," ",a==null?void 0:a.user_email]})]}),s.jsxs("div",{className:"flex flex-col justify-between p-4 space-y-4 ",children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:a==null?void 0:a.retailer}),s.jsxs("h2",{className:"text-lg font-medium text-gray-700",children:["Order Id: ",a==null?void 0:a.order_id]}),s.jsxs("p",{className:"text-gray-600 text-justify",children:["Order Amount: ",a==null?void 0:a.order_amt]}),s.jsxs("p",{className:"text-lg font-semibold ",children:["Reward Amount: ",s.jsxs("span",{className:"text-green-600",children:["₹ ",a==null?void 0:a.reward_amt]})]}),s.jsxs("aside",{className:"flex flex-col bg-white shadow-md rounded-lg mt-5 p-2 ",children:[s.jsx("h2",{className:"text-lg w-full font-medium text-center p-2",children:"Reward Configuration"}),s.jsxs("div",{className:"w-full mx-auto  bg-white shadow-sm rounded-lg",children:[s.jsxs("button",{className:"text-base w-full flex justify-between items-center p-3 text-left font-normal  rounded-lg focus:outline-none",onClick:()=>r(!n),children:[s.jsx("span",{children:"Reward points"}),s.jsx("span",{children:n?"▲":"▼"})]}),s.jsxs("div",{className:`overflow-hidden transition-max-height duration-500 ease-in-out flex flex-col ${n?"max-h-96 p-4":"max-h-0 p-0"}`,children:[s.jsx("input",{id:"rewardAmount",type:"text",value:o,onChange:e=>x(e.target.value),placeholder:"Enter new reward points",className:"w-full border rounded-lg p-2 text-gray-700 focus:outline-none focus:ring focus:ring-gray-200"}),s.jsx("button",{className:"mt-4 w-fit px-5 bg-primary ml-auto text-white py-2 rounded-lg hover:bg-primary",children:"Process Now"})]})]})]})]})]}),s.jsxs("section",{className:"w-full md:w-[60%] max-h-fit rounded-xl mx-auto  bg-white shadow-md",children:[s.jsxs("div",{className:"flex items-center p-4 border-b bg-primary text-white gap-2 mb-4",children:[s.jsx(K,{size:30}),s.jsxs("div",{children:[s.jsx("p",{className:"text-lg font-semibold",children:a==null?void 0:a.user_name}),s.jsx("p",{className:"text-sm",children:"Support Chat"})]})]}),s.jsx("div",{ref:g,className:"h-96 overflow-y-auto px-10 scrollbar-thin scrollbar-thumb-gray-600",children:u==null?void 0:u.map(e=>s.jsxs("div",{className:`mb-4 ${(e==null?void 0:e.actor)===1?"text-right ":"text-left"}`,children:[s.jsx("p",{className:"text-sm font-semibold",children:e.actor==1?"Cheggout":a==null?void 0:a.user_name}),s.jsx("div",{className:`chatBox relative inline-block p-2 rounded-lg ${(e==null?void 0:e.actor)===1?"bg-blue-100 chatBox_admin":"bg-gray-200 chatBox_customer"}`,children:T(e==null?void 0:e.msg)?s.jsx("img",{src:e==null?void 0:e.msg,alt:"Chat Attachment",className:"mt-2 max-w-xs rounded"}):s.jsx("p",{children:e==null?void 0:e.msg})}),s.jsx("p",{className:"text-xs text-gray-500",children:new Date(e==null?void 0:e.created_at).toLocaleString()})]},e==null?void 0:e.created_at))}),s.jsxs("div",{className:"flex items-center p-3 border-t bg-gray-100",children:[s.jsx("input",{type:"text",placeholder:"Enter your message here",value:c,onChange:e=>y(e.target.value),className:"flex-1 p-2 border rounded-lg"}),s.jsx(f,{size:"sm",variant:"solid",onClick:()=>A(c,a==null?void 0:a.Id),type:"submit",className:"ml-2",children:"Reply"})]})]})]}),s.jsxs(H,{className:"-mx-8 px-8 flex items-center justify-end py-4 z-10 gap-2",stickyClass:"border-t bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700",children:[s.jsx(f,{size:"sm",variant:"solid",onClick:_,type:"submit",children:"Discard"}),s.jsx(f,{size:"sm",variant:"solid",color:"red",loading:N,icon:s.jsx(W,{}),onClick:()=>I({id:a==null?void 0:a.Id,report_status:"resolved"},v),type:"submit",children:"Close Ticket"})]})]})};se.displayName="RewardTrackingDetails";export{se as default};
